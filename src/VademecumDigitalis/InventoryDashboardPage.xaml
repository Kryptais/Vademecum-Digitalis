<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:viewmodels="clr-namespace:VademecumDigitalis.ViewModels"
             xmlns:local="clr-namespace:VademecumDigitalis"
             x:Class="VademecumDigitalis.InventoryDashboardPage"
             Title="Inventar">

    <!-- BindingContext is assigned in code-behind from DI to share the VM instance -->

    <ScrollView Margin="10">
        <VerticalStackLayout  Spacing="12">
            <Label Text="Globale Bank" Style="{StaticResource HeadlineLabel}" />
            <Border BackgroundColor="Black" Padding="0" Margin="5" StrokeShape="RoundRectangle 15" >
                <Grid  ColumnSpacing="10" Margin="10" RowSpacing="20">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="Auto" />
                    <RowDefinition Height="Auto" />
                </Grid.RowDefinitions>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto" />   
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>
                    <!-- Dukaten: Gold -->
                    <Label Text="Dukaten:" Grid.Row="0" Grid.Column="0" FontAttributes="Bold" TextColor="Gold" />
                    <Label x:Name="DukatenLabel" Text="0" Grid.Row="0" Grid.Column="1" TextColor="Gold" />
                    <!-- Silbertaler: Silber -->
                    <Label Text="Silbertaler:" Grid.Row="1" Grid.Column="0" FontAttributes="Bold" TextColor="Silver" />
                    <Label x:Name="SilbertalerLabel" Text="0" Grid.Row="1" Grid.Column="1" TextColor="Silver" />
                    <!-- Heller: Bronze (Hex) -->
                    <Label Text="Heller:" Grid.Row="2" Grid.Column="0" FontAttributes="Bold" TextColor="#CD7F32" />
                    <Label x:Name="HellerLabel" Text="0" Grid.Row="2" Grid.Column="1" TextColor="#CD7F32" />
                    <!-- Kreuzer: Eisern (stahlgrau) -->
                    <Label Text="Kreuzer:" Grid.Row="3" Grid.Column="0" FontAttributes="Bold" TextColor="#6E6E6E" />
                    <Label x:Name="KreuzerLabel" Text="0" Grid.Row="3" Grid.Column="1" TextColor="#6E6E6E" />
                </Grid>
            </Border>

            <Label Text="Inventare:" Style="{StaticResource HeadlineLabel}" HorizontalTextAlignment="Center" />

            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*" />
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>
                <SearchBar Grid.Column="0" Placeholder="Container suchen..." TextChanged="OnSearchBarTextChanged" BackgroundColor="#2A2A2A" TextColor="White" PlaceholderColor="#999" Margin="0,0,5,5"/>
                <Button Grid.Column="1" Text="Item suchen" Clicked="OnGlobalSearch" Margin="0,0,5,5" BackgroundColor="#333" FontAttributes="None" FontSize="14" Padding="10,0"/>
                <Button Grid.Column="2" Text="Neu" Clicked="OnCreateNewContainer" Margin="0,0,0,5"  FontAttributes="None" FontSize="14" Padding="10,0"/>
            </Grid>

            <!-- Weight Summary -->
            <Grid ColumnDefinitions="*, *" RowDefinitions="*, *" Margin="0">
                <Border Grid.Row="0" Grid.Column="0" VerticalOptions="Center" Grid.ColumnSpan="2" BackgroundColor="Black" Padding="0" Margin="5" StrokeShape="RoundRectangle 15" >
                    <Grid ColumnDefinitions="Auto,Auto" VerticalOptions="Center" Margin="10" >
                        <Label Text="Gesamtgewicht:" VerticalOptions="Center" FontAttributes="Bold" Grid.Column="0" FontSize="16"  />
                        <Entry x:Name="AllInventoriesWeightLabel" Grid.Column="2" VerticalOptions="Center" IsReadOnly="True" FontSize="16" FontAttributes="Bold"  Text="0.00 Stein" WidthRequest="150"
                               BackgroundColor="#2A2A2A" TextColor="#6E6E6E" PlaceholderColor="#666" HeightRequest="30" Margin="9" />
                    </Grid>
                </Border>
                <Border Grid.Row="1" Grid.Column="0" Grid.ColumnSpan="2" BackgroundColor="Black" Padding="0" Margin="5" StrokeShape="RoundRectangle 15" >
                    <Grid ColumnDefinitions="Auto,auto" VerticalOptions="Center" Margin="10" >
                        <Label Text="Getragenes Gewicht:" FontAttributes="Bold" VerticalOptions="Center" Grid.Column="0" FontSize="16"  />
                        <Entry x:Name="CarriedInventoriesWeightLabel" Grid.Column="1" FontSize="16" FontAttributes="Bold"  IsReadOnly="True" Text="0.00 Stein" WidthRequest="150"
                               BackgroundColor="#2A2A2A" TextColor="#6E6E6E" PlaceholderColor="#666" HeightRequest="30" Margin="9"  />
                    </Grid>
                </Border>

            </Grid>

            <CollectionView ItemsSource="{Binding FilteredContainers, Source={RelativeSource AncestorType={x:Type local:InventoryDashboardPage}}}" SelectionMode="Single" SelectionChanged="OnContainerSelected">
                <CollectionView.Header>
                    <Border StrokeThickness="0" BackgroundColor="#2A2A2A" Padding="0" Margin="4,0,4,4" StrokeShape="RoundRectangle 8">
                        <Grid Padding="12" ColumnSpacing="10">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="2*" />
                                <ColumnDefinition Width="1*" />
                                <ColumnDefinition Width="1*" />
                                <ColumnDefinition Width="1*" />
                            </Grid.ColumnDefinitions>
                            <Label Text="Name" Style="{StaticResource TableHeaderLabel}" Grid.Column="0" />
                            <Label Text="Getragen" Style="{StaticResource TableHeaderLabel}" Grid.Column="1" />
                            <Label Text="Gewicht" Style="{StaticResource TableHeaderLabel}" Grid.Column="2" />
                            <Label Text="Geld" Style="{StaticResource TableHeaderLabel}" Grid.Column="3" />
                        </Grid>
                    </Border>
                </CollectionView.Header>
                <CollectionView.ItemTemplate>
                    <DataTemplate>
                        <!-- Item-Container als Border mit VisualState fuer Selected -->
                        <Border Padding="12" Margin="4" StrokeShape="RoundRectangle 8" BackgroundColor="#1E1E1E" Stroke="#333" StrokeThickness="1">
                            <VisualStateManager.VisualStateGroups>
                                <VisualStateGroup Name="CommonStates">
                                    <VisualState Name="Normal">
                                        <VisualState.Setters>
                                            <Setter Property="BackgroundColor" Value="#1E1E1E" />
                                        </VisualState.Setters>
                                    </VisualState>
                                    <VisualState Name="Selected">
                                        <VisualState.Setters>
                                            <!-- gewuenschte Selektionsfarbe hier setzen (halbtransparent dunkel) -->
                                            <Setter Property="BackgroundColor" Value="#333333" />
                                            <Setter Property="Stroke" Value="#666" />
                                        </VisualState.Setters>
                                    </VisualState>
                                </VisualStateGroup>
                            </VisualStateManager.VisualStateGroups>

                            <Grid ColumnSpacing="10">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="2*" />
                                    <ColumnDefinition Width="1*" />
                                    <ColumnDefinition Width="1*" />
                                    <ColumnDefinition Width="1*" />
                                </Grid.ColumnDefinitions>
                                <Label Text="{Binding Name}" HorizontalOptions="Center"  FontAttributes="Bold" Grid.Column="0"  TextColor="White" FontSize="16" VerticalTextAlignment="Center"/>
                                <HorizontalStackLayout Grid.Column="1" Spacing="8" HorizontalOptions="Center">
                                    <CheckBox IsChecked="{Binding IsCarried, Mode=TwoWay}" Color="#E6E6E6" HorizontalOptions="Center"  />
                                </HorizontalStackLayout>
    
                                <Label Grid.Column="2" Text="{Binding TotalWeight, StringFormat='{0:N2} Stein'}" FontSize="16"  VerticalOptions="Center" TextColor="#CCCCCC" HorizontalTextAlignment="Center" FontAttributes="Bold"/>

                                <HorizontalStackLayout Grid.Column="3" Spacing="8" VerticalOptions="Center" HorizontalOptions="Center">
                                     <HorizontalStackLayout Spacing="4">
                                        <Label Text="{Binding Money.Dukaten}" TextColor="Gold"  Style="{StaticResource  TableHeaderLabel}"/>
                                        <Label Text="D" TextColor="Gold" FontAttributes="Bold" Style="{StaticResource  TableHeaderLabel}" />
                                    </HorizontalStackLayout>
                                     <HorizontalStackLayout Spacing="4">
                                        <Label Text="{Binding Money.Silbertaler}" TextColor="Silver" Style="{StaticResource  TableHeaderLabel}"/>
                                        <Label Text="S" TextColor="Silver" FontAttributes="Bold" Style="{StaticResource  TableHeaderLabel}" />
                                    </HorizontalStackLayout>
                                    <HorizontalStackLayout Spacing="4">
                                        <Label Text="{Binding Money.Heller}" TextColor="#CD7F32" Style="{StaticResource  TableHeaderLabel}"/>
                                        <Label Text="H" TextColor="#CD7F32" FontAttributes="Bold" Style="{StaticResource  TableHeaderLabel}" />
                                    </HorizontalStackLayout>
                                    <HorizontalStackLayout Spacing="4">
                                        <Label Text="{Binding Money.Kreuzer}" TextColor="#6E6E6E" Style="{StaticResource  TableHeaderLabel}" />
                                        <Label Text="K" TextColor="#6E6E6E" FontAttributes="Bold" Style="{StaticResource  TableHeaderLabel}" />
                                    </HorizontalStackLayout>
                                </HorizontalStackLayout>
                            </Grid>
                        </Border>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>
        </VerticalStackLayout>
    </ScrollView>
</ContentPage>
